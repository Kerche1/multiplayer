<!DOCTYPE html>
<html>
<head>
  <title>Multi-Control (–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <script src="/socket.io/socket.io.js"></script>
  <style>
    body { margin: 0; font-family: Arial; background: #1a1a1a; color: white; }
    #screen { width: 75%; height: 90vh; background: #000; position: relative; float: left; }
    #sidebar { width: 25%; height: 90vh; background: #2a2a2a; float: left; padding: 20px; }
    canvas { position: absolute; top: 0; left: 0; pointer-events: none; }
    button { padding: 10px; margin: 5px; background: #007bff; color: white; border: none; border-radius: 5px; cursor: pointer; }
    input { padding: 10px; margin: 5px; border-radius: 5px; border: 1px solid #444; background: #3a3a3a; color: white; }
    #chat { height: 200px; overflow-y: auto; background: #3a3a3a; padding: 10px; border-radius: 5px; margin: 10px 0; }
  </style>
</head>
<body>
  <div id="screen">
    <canvas id="screenCanvas" width="800" height="600"></canvas>
    <canvas id="cursorCanvas" width="800" height="600"></canvas>
  </div>
  <div id="sidebar">
    <div id="status">‚è≥ –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ...</div>
    <input id="roomId" value="room1" placeholder="–ö–æ–¥ –∫–æ–º–Ω–∞—Ç—ã">
    <br><button onclick="joinRoom()">üöÄ –ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è</button>
    <div>üë• <span id="users">0</span> –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</div>
    <div id="chat"></div>
    <input id="chatInput" placeholder="–ß–∞—Ç..." onkeypress="if(event.key==='Enter') sendChat()">
    <button onclick="sendChat()">üì§</button>
  </div>

  <script>
    const socket = io();
    const screenCanvas = document.getElementById('screenCanvas');
    const cursorCanvas = document.getElementById('cursorCanvas');
    const ctxScreen = screenCanvas.getContext('2d');
    const ctxCursor = cursorCanvas.getContext('2d');
    let roomId = 'room1';

    // –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ
    function joinRoom() {
      roomId = document.getElementById('roomId').value;
      socket.emit('join-room', { roomId });
    }

    // –†–∏—Å–æ–≤–∞–Ω–∏–µ —Ñ–æ–Ω–∞ (–∏–º–∏—Ç–∞—Ü–∏—è —ç–∫—Ä–∞–Ω–∞)
    function drawScreen() {
      ctxScreen.fillStyle = '#333';
      ctxScreen.fillRect(0, 0, screenCanvas.width, screenCanvas.height);
      ctxScreen.fillStyle = '#fff';
      ctxScreen.font = '24px Arial';
      ctxScreen.textAlign = 'center';
      ctxScreen.fillText('üì∫ –≠–ö–†–ê–ù –†–ê–ë–û–¢–ê–ï–¢!', screenCanvas.width/2, screenCanvas.height/2);
    }
    drawScreen();

    // –ö—É—Ä—Å–æ—Ä—ã
    socket.on('remote-cursor', (data) => {
      ctxCursor.clearRect(0, 0, cursorCanvas.width, cursorCanvas.height);
      ctxCursor.fillStyle = data.color;
      ctxCursor.beginPath();
      ctxCursor.arc(data.x, data.y, 10, 0, Math.PI*2);
      ctxCursor.fill();
      ctxCursor.fillStyle = 'white';
      ctxCursor.font = '12px Arial';
      ctxCursor.textAlign = 'center';
      ctxCursor.fillText(data.userId, data.x, data.y-15);
    });

    // –õ–æ–∫–∞–ª—å–Ω—ã–π –∫—É—Ä—Å–æ—Ä
    screenCanvas.addEventListener('mousemove', (e) => {
      const rect = screenCanvas.getBoundingClientRect();
      const x = e.clientX - rect.left;
      const y = e.clientY - rect.top;
      socket.emit('cursor-move', { roomId, x, y });
    });

    // –ö–ª–∏–∫ –ø–æ —ç–∫—Ä–∞–Ω—É
    screenCanvas.addEventListener('click', (e) => {
      const rect = screenCanvas.getBoundingClientRect();
      const x = e.clientX - rect.left;
      const y = e.clientY - rect.top;
      socket.emit('remote-input', { roomId, type: 'click', x, y });
      
      // –õ–æ–∫–∞–ª—å–Ω—ã–π —ç—Ñ—Ñ–µ–∫—Ç
      ctxScreen.fillStyle = 'rgba(255,255,0,0.5)';
      ctxScreen.beginPath();
      ctxScreen.arc(x, y, 20, 0, Math.PI*2);
      ctxScreen.fill();
      setTimeout(drawScreen, 200);
    });

    // –°–æ–±—ã—Ç–∏—è —Å–æ–∫–µ—Ç–æ–≤
    socket.on('connect', () => {
      document.getElementById('status').innerHTML = '‚úÖ <strong>–ü–û–î–ö–õ–Æ–ß–ï–ù</strong>';
    });

    socket.on('user-joined', (data) => {
      document.getElementById('users').textContent = data.users;
      document.getElementById('status').innerHTML = `‚úÖ ${roomId} | ${data.users} —á–µ–ª.`;
    });

    socket.on('chat-message', (data) => {
      const chat = document.getElementById('chat');
      chat.innerHTML += `<div>${data.message}</div>`;
      chat.scrollTop = chat.scrollHeight;
    });

    function sendChat() {
      const msg = document.getElementById('chatInput').value.trim();
      if (msg) {
        socket.emit('chat-message', { roomId, message: `üí¨ ${msg}` });
        document.getElementById('chatInput').value = '';
      }
    }
  </script>
</body>
</html>
